<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.linkwee.web.dao.CrmCfplannerMapper">
	<!-- Result Map-->
	<resultMap  type="com.linkwee.web.model.CrmCfplanner" id="BaseResultMap">
		<result column="id" property="id" jdbcType="INTEGER"/>
		<result column="user_id" property="userId" jdbcType="VARCHAR"/>
		<result column="mobile" property="mobile" jdbcType="VARCHAR"/>
		<result column="email" property="email" jdbcType="VARCHAR"/>
		<result column="parent_id" property="parentId" jdbcType="VARCHAR"/>
		<result column="qrcode" property="qrcode" jdbcType="VARCHAR"/>
		<result column="emp_no" property="empNo" jdbcType="VARCHAR"/>
		<result column="department" property="department" jdbcType="VARCHAR"/>
		<result column="settlement_type" property="settlementType" jdbcType="TINYINT"/>
		<result column="cfp_level" property="cfpLevel" jdbcType="VARCHAR"/>
		<result column="cfp_reg_time" property="cfpRegTime" jdbcType="TIMESTAMP"/>
		<result column="cfp_benormal_time" property="cfpBenormalTime" jdbcType="TIMESTAMP"/>
		<result column="cfp_update_time" property="cfpUpdateTime" jdbcType="TIMESTAMP"/>
		<result column="level_experience" property="levelExperience" jdbcType="INTEGER"/>
		<result column="head_image" property="headImage" jdbcType="VARCHAR"/>
		<result column="remark" property="remark" jdbcType="VARCHAR"/>
		<result column="disabled_login_time" property="disabledLoginTime" jdbcType="TIMESTAMP"/>
		<result column="easemob_acct" property="easemobAcct" jdbcType="VARCHAR"/>
		<result column="easemob_password" property="easemobPassword" jdbcType="VARCHAR"/>
		<result column="easemob_reg_status" property="easemobRegStatus" jdbcType="INTEGER"/>
		<result column="easemob_nickname_status" property="easemobNicknameStatus" jdbcType="INTEGER"/>
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
		<result column="is_locked" property="isLocked" jdbcType="TINYINT"/>
		<result column="enable" property="enable" jdbcType="TINYINT"/>
		<result column="del_status" property="delStatus" jdbcType="TINYINT"/>
		<result column="sales_org_id" property="salesOrgId" jdbcType="VARCHAR"/>
		<result column="job_grade" property="jobGrade" jdbcType="VARCHAR"/>
		<result column="job_grade_weight" property="jobGradeWeight" jdbcType="TINYINT"/>
		<result column="sales_org_depth" property="salesOrgDepth" jdbcType="INTEGER"/>
	</resultMap>
	
	<resultMap  type="com.linkwee.web.model.CrmCfplanner" id="BaseResultMap2" extends="BaseResultMap">
		<result column="user_name" property="userName" jdbcType="VARCHAR"/>
	</resultMap>
	
  <sql id="Base_Column_List">
    <trim suffixOverrides=",">
	    	id,
	    	user_id,
	    	mobile,
	    	email,
	    	parent_id,
	    	qrcode,
	    	emp_no,
	    	department,
	    	settlement_type,
	    	cfp_level,
	    	cfp_reg_time,
	    	cfp_benormal_time,
	    	cfp_update_time,
	    	level_experience,
	    	head_image,
	    	remark,
	    	disabled_login_time,
	    	easemob_acct,
	    	easemob_password,
	    	easemob_reg_status,
	    	easemob_nickname_status,
	    	create_time,
	    	update_time,
	    	is_locked,
	    	enable,
	    	del_status,
	    	sales_org_id,
	    	job_grade,
	    	job_grade_weight,
	    	sales_org_depth,
    </trim>
  </sql>  
  
  <sql id="Base_Condition">
		<if test=" null != id ">
			and t.id = #{id}
		</if>
		<if test=" null != userId and ''!= userId  ">
			and t.user_id = #{userId}
		</if>
		<if test=" null != mobile and ''!= mobile  ">
			and t.mobile = #{mobile}
		</if>
		<if test=" null != email and ''!= email  ">
			and t.email = #{email}
		</if>
		<if test=" null != parentId and ''!= parentId  ">
			and t.parent_id = #{parentId}
		</if>
		<if test=" null != qrcode and ''!= qrcode  ">
			and t.qrcode = #{qrcode}
		</if>
		<if test=" null != empNo and ''!= empNo  ">
			and t.emp_no = #{empNo}
		</if>
		<if test=" null != department and ''!= department  ">
			and t.department = #{department}
		</if>
		<if test=" null != settlementType ">
			and t.settlement_type = #{settlementType}
		</if>
		<if test=" null != cfpLevel and ''!= cfpLevel  ">
			and t.cfp_level = #{cfpLevel}
		</if>
		<if test=" null != cfpRegTime ">
			and t.cfp_reg_time = #{cfpRegTime}
		</if>
		<if test=" null != cfpBenormalTime ">
			and t.cfp_benormal_time = #{cfpBenormalTime}
		</if>
		<if test=" null != cfpUpdateTime ">
			and t.cfp_update_time = #{cfpUpdateTime}
		</if>
		<if test=" null != levelExperience ">
			and t.level_experience = #{levelExperience}
		</if>
		<if test=" null != headImage and ''!= headImage  ">
			and t.head_image = #{headImage}
		</if>
		<if test=" null != remark and ''!= remark  ">
			and t.remark = #{remark}
		</if>
		<if test=" null != disabledLoginTime ">
			and t.disabled_login_time = #{disabledLoginTime}
		</if>
		<if test=" null != easemobAcct and ''!= easemobAcct  ">
			and t.easemob_acct = #{easemobAcct}
		</if>
		<if test=" null != easemobPassword and ''!= easemobPassword  ">
			and t.easemob_password = #{easemobPassword}
		</if>
		<if test=" null != easemobRegStatus and ''!= easemobRegStatus  ">
			and t.easemob_reg_status = #{easemobRegStatus}
		</if>
		<if test=" null != easemobNicknameStatus and ''!= easemobNicknameStatus  ">
			and t.easemob_nickname_status = #{easemobNicknameStatus}
		</if>
		<if test=" null != createTime ">
			and t.create_time = #{createTime}
		</if>
		<if test=" null != updateTime ">
			and t.update_time = #{updateTime}
		</if>
		<if test=" null != isLocked ">
			and t.is_locked = #{isLocked}
		</if>
		<if test=" null != enable ">
			and t.enable = #{enable}
		</if>
		<if test=" null != delStatus ">
			and t.del_status = #{delStatus}
		</if>
		<if test=" null != salesOrgId ">
			and t.sales_org_id = #{salesOrgId}
		</if>
		<if test=" null != jobGrade ">
			and t.job_grade = #{jobGrade}
		</if>
		<if test=" null != jobGradeWeight ">
			and t.job_grade_weight = #{jobGradeWeight}
		</if>
		<if test=" null != salesOrgDepth ">
			and t.sales_org_depth = #{salesOrgDepth}
		</if>
  </sql>

  <select id="selectOneByCondition" resultMap="BaseResultMap2"  parameterType="com.linkwee.web.model.CrmCfplanner">
		select t.*, u.user_name from tcrm_cfplanner t join tcrm_user_info u on t.user_id=u.user_id
		where 1=1 <include refid="Base_Condition" />
  </select>
  
  <select id="selectByCondition" resultMap="BaseResultMap"  parameterType="com.linkwee.web.model.CrmCfplanner">
		select t.* from tcrm_cfplanner t
		where 1=1 <include refid="Base_Condition" />
  </select>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from tcrm_cfplanner
    where  id = #{0}
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    delete from tcrm_cfplanner
    where id = #{0}
  </delete>

  <insert id="insert" parameterType="com.linkwee.web.model.CrmCfplanner" >
    INSERT INTO tcrm_cfplanner
		<trim prefix="(" suffix=")" suffixOverrides=",">
			 	<if test=" null != id ">
					id,
				</if>
			 	<if test=" null != userId and ''!= userId  ">
					user_id,
				</if>
			 	<if test=" null != mobile and ''!= mobile  ">
					mobile,
				</if>
			 	<if test=" null != email and ''!= email  ">
					email,
				</if>
			 	<if test=" null != parentId and ''!= parentId  ">
					parent_id,
				</if>
			 	<if test=" null != qrcode and ''!= qrcode  ">
					qrcode,
				</if>
			 	<if test=" null != empNo and ''!= empNo  ">
					emp_no,
				</if>
			 	<if test=" null != department and ''!= department  ">
					department,
				</if>
			 	<if test=" null != settlementType ">
					settlement_type,
				</if>
			 	<if test=" null != cfpLevel and ''!= cfpLevel  ">
					cfp_level,
				</if>
			 	<if test=" null != cfpRegTime ">
					cfp_reg_time,
				</if>
			 	<if test=" null != cfpBenormalTime ">
					cfp_benormal_time,
				</if>
			 	<if test=" null != cfpUpdateTime ">
					cfp_update_time,
				</if>
			 	<if test=" null != levelExperience ">
					level_experience,
				</if>
			 	<if test=" null != headImage and ''!= headImage  ">
					head_image,
				</if>
			 	<if test=" null != remark and ''!= remark  ">
					remark,
				</if>
			 	<if test=" null != disabledLoginTime ">
					disabled_login_time,
				</if>
				<if test=" null != registerFromUrl ">
					register_from_url,
				</if>
				<if test=" null != registerAccessUrl ">
					register_access_url,
				</if>
				<if test=" null != easemobAcct and ''!= easemobAcct  ">
					easemob_acct,
				</if>
				<if test=" null != easemobPassword and ''!= easemobPassword  ">
					easemob_password,
				</if>
				create_time = CURRENT_TIMESTAMP,
			 	<if test=" null != updateTime ">
					update_time,
				</if>
			 	<if test=" null != isLocked ">
					is_locked,
				</if>
			 	<if test=" null != enable ">
					enable,
				</if>
			 	<if test=" null != delStatus ">
					del_status,
				</if>
				<if test=" null != salesOrgId ">
					sales_org_id,
				</if>
				<if test=" null != salesOrgDepth ">
					sales_org_depth,
				</if>
		</trim>
		<trim prefix="VALUES(" suffix=")" suffixOverrides=",">
			 	<if test=" null != id ">
					 	#{id},
				</if>
			 	<if test=" null != userId and ''!= userId  ">
					 	#{userId},
				</if>
			 	<if test=" null != mobile and ''!= mobile  ">
					 	#{mobile},
				</if>
			 	<if test=" null != email and ''!= email  ">
					 	#{email},
				</if>
			 	<if test=" null != parentId and ''!= parentId  ">
					 	#{parentId},
				</if>
			 	<if test=" null != qrcode and ''!= qrcode  ">
					 	#{qrcode},
				</if>
			 	<if test=" null != empNo and ''!= empNo  ">
					 	#{empNo},
				</if>
			 	<if test=" null != department and ''!= department  ">
					 	#{department},
				</if>
			 	<if test=" null != settlementType ">
					 	#{settlementType},
				</if>
			 	<if test=" null != cfpLevel and ''!= cfpLevel  ">
					 	#{cfpLevel},
				</if>
			 	<if test=" null != cfpRegTime ">
					 	#{cfpRegTime},
				</if>
			 	<if test=" null != cfpBenormalTime ">
					 	#{cfpBenormalTime},
				</if>
			 	<if test=" null != cfpUpdateTime ">
					 	#{cfpUpdateTime},
				</if>
			 	<if test=" null != levelExperience ">
					 	#{levelExperience},
				</if>
			 	<if test=" null != headImage and ''!= headImage  ">
					 	#{headImage},
				</if>
			 	<if test=" null != remark and ''!= remark  ">
					 	#{remark},
				</if>
			 	<if test=" null != disabledLoginTime ">
					 	#{disabledLoginTime},
				</if>
				<if test=" null != registerFromUrl ">
					 	#{registerFromUrl},
				</if>
				<if test=" null != registerAccessUrl ">
					 	#{registerAccessUrl},
				</if>
				<if test=" null != easemobAcct and ''!= easemobAcct  ">
						#{easemobAcct},
				</if>
				<if test=" null != easemobPassword and ''!= easemobPassword  ">
						#{easemobPassword},
				</if>
			 	<if test=" null != createTime ">
					 	#{createTime},
				</if>
			 	<if test=" null != updateTime ">
					 	#{updateTime},
				</if>
			 	<if test=" null != isLocked ">
					 	#{isLocked},
				</if>
			 	<if test=" null != enable ">
					 	#{enable},
				</if>
			 	<if test=" null != delStatus ">
					 	#{delStatus},
				</if>
				<if test=" null != salesOrgId ">
					 	#{salesOrgId},
				</if>
				<if test=" null != salesOrgDepth ">
						#{salesOrgDepth},
				</if>
		</trim>
  </insert>
  
  <insert id="insertSelective" parameterType="com.linkwee.web.model.CrmCfplanner" useGeneratedKeys="true" keyProperty="id" >
		INSERT INTO tcrm_cfplanner
		<trim prefix="(" suffix=")" suffixOverrides=",">
			 	<if test=" null != id ">
					id,
				</if>
			 	<if test=" null != userId and ''!= userId  ">
					user_id,
				</if>
			 	<if test=" null != mobile and ''!= mobile  ">
					mobile,
				</if>
			 	<if test=" null != email and ''!= email  ">
					email,
				</if>
			 	<if test=" null != parentId and ''!= parentId  ">
					parent_id,
				</if>
			 	<if test=" null != qrcode and ''!= qrcode  ">
					qrcode,
				</if>
			 	<if test=" null != empNo and ''!= empNo  ">
					emp_no,
				</if>
			 	<if test=" null != department and ''!= department  ">
					department,
				</if>
			 	<if test=" null != settlementType ">
					settlement_type,
				</if>
			 	<if test=" null != cfpLevel and ''!= cfpLevel  ">
					cfp_level,
				</if>
			 	<if test=" null != cfpRegTime ">
					cfp_reg_time,
				</if>
			 	<if test=" null != cfpBenormalTime ">
					cfp_benormal_time,
				</if>
			 	<if test=" null != cfpUpdateTime ">
					cfp_update_time,
				</if>
			 	<if test=" null != levelExperience ">
					level_experience,
				</if>
			 	<if test=" null != headImage and ''!= headImage  ">
					head_image,
				</if>
			 	<if test=" null != remark and ''!= remark  ">
					remark,
				</if>
				<if test=" null != rectVisitTime ">
					rect_visit_time,
				</if>
			 	<if test=" null != disabledLoginTime ">
					disabled_login_time,
				</if>
				<if test=" null != registerFromUrl ">
					register_from_url,
				</if>
				<if test=" null != registerAccessUrl ">
					register_access_url,
				</if>
				<if test=" null != easemobAcct and ''!= easemobAcct  ">
					easemob_acct,
				</if>
				<if test=" null != easemobPassword and ''!= easemobPassword  ">
					easemob_password,
				</if>
			 	<if test=" null != createTime ">
					create_time,
				</if>
			 	<if test=" null != updateTime ">
					update_time,
				</if>
			 	<if test=" null != isLocked ">
					is_locked,
				</if>
			 	<if test=" null != enable ">
					enable,
				</if>
			 	<if test=" null != delStatus ">
					del_status,
				</if>
				<if test=" null != salesOrgId ">
					sales_org_id,
				</if>
				<if test=" null != salesOrgDepth ">
					sales_org_depth,
				</if>
		</trim>
		<trim prefix="VALUES(" suffix=")" suffixOverrides=",">
			 	<if test=" null != id ">
					 	#{id},
				</if>
			 	<if test=" null != userId and ''!= userId  ">
					 	#{userId},
				</if>
			 	<if test=" null != mobile and ''!= mobile  ">
					 	#{mobile},
				</if>
			 	<if test=" null != email and ''!= email  ">
					 	#{email},
				</if>
			 	<if test=" null != parentId and ''!= parentId  ">
					 	#{parentId},
				</if>
			 	<if test=" null != qrcode and ''!= qrcode  ">
					 	#{qrcode},
				</if>
			 	<if test=" null != empNo and ''!= empNo  ">
					 	#{empNo},
				</if>
			 	<if test=" null != department and ''!= department  ">
					 	#{department},
				</if>
			 	<if test=" null != settlementType ">
					 	#{settlementType},
				</if>
			 	<if test=" null != cfpLevel and ''!= cfpLevel  ">
					 	#{cfpLevel},
				</if>
			 	<if test=" null != cfpRegTime ">
					 	#{cfpRegTime},
				</if>
			 	<if test=" null != cfpBenormalTime ">
					 	#{cfpBenormalTime},
				</if>
			 	<if test=" null != cfpUpdateTime ">
					 	#{cfpUpdateTime},
				</if>
			 	<if test=" null != levelExperience ">
					 	#{levelExperience},
				</if>
			 	<if test=" null != headImage and ''!= headImage  ">
					 	#{headImage},
				</if>
			 	<if test=" null != remark and ''!= remark  ">
					 	#{remark},
				</if>
				<if test=" null != rectVisitTime ">
					 	#{rectVisitTime},
				</if>
			 	<if test=" null != disabledLoginTime ">
					 	#{disabledLoginTime},
				</if>
				<if test=" null != registerFromUrl ">
					 	#{registerFromUrl},
				</if>
				<if test=" null != registerAccessUrl ">
					 	#{registerAccessUrl},
				</if>
				<if test=" null != easemobAcct and ''!= easemobAcct  ">
						#{easemobAcct},
				</if>
				<if test=" null != easemobPassword and ''!= easemobPassword  ">
						#{easemobPassword},
				</if>
			 	<if test=" null != createTime ">
					 	#{createTime},
				</if>
			 	<if test=" null != updateTime ">
					 	#{updateTime},
				</if>
			 	<if test=" null != isLocked ">
					 	#{isLocked},
				</if>
			 	<if test=" null != enable ">
					 	#{enable},
				</if>
			 	<if test=" null != delStatus ">
					 	#{delStatus},
				</if>
				<if test=" null != salesOrgId ">
					 	#{salesOrgId},
				</if>
				<if test=" null != salesOrgDepth ">
						#{salesOrgDepth},
				</if>
		</trim>
	</insert>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.linkwee.web.model.CrmCfplanner" >
  		UPDATE tcrm_cfplanner
		<set>
			<trim suffixOverrides=",">
					<if test=" null != userId and ''!= userId  ">
						user_id = #{userId},
					</if>
					<if test=" null != mobile and ''!= mobile  ">
						mobile = #{mobile},
					</if>
					<if test=" null != email and ''!= email  ">
						email = #{email},
					</if>
					<if test=" null != parentId and ''!= parentId  ">
						parent_id = #{parentId},
					</if>
					<if test=" null != qrcode and ''!= qrcode  ">
						qrcode = #{qrcode},
					</if>
					<if test=" null != empNo and ''!= empNo  ">
						emp_no = #{empNo},
					</if>
					<if test=" null != department and ''!= department  ">
						department = #{department},
					</if>
					<if test=" null != settlementType ">
						settlement_type = #{settlementType},
					</if>
					<if test=" null != cfpLevel and ''!= cfpLevel  ">
						cfp_level = #{cfpLevel},
					</if>
					<if test=" null != cfpRegTime ">
						cfp_reg_time = #{cfpRegTime},
					</if>
					<if test=" null != cfpBenormalTime ">
						cfp_benormal_time = #{cfpBenormalTime},
					</if>
					<if test=" null != cfpUpdateTime ">
						cfp_update_time = #{cfpUpdateTime},
					</if>
					<if test=" null != levelExperience ">
						level_experience = #{levelExperience},
					</if>
					<if test=" null != headImage and ''!= headImage  ">
						head_image = #{headImage},
					</if>
					<if test=" null != remark and ''!= remark  ">
						remark = #{remark},
					</if>
					<if test=" null != disabledLoginTime ">
						disabled_login_time = #{disabledLoginTime},
					</if>
					<if test=" null != easemobAcct and ''!= easemobAcct  ">
						easemob_acct = #{easemobAcct},
					</if>
					<if test=" null != easemobPassword and ''!= easemobPassword  ">
						easemob_password = #{easemobPassword},
					</if>
					<if test=" null != easemobRegStatus and ''!= easemobRegStatus  ">
						easemob_reg_status = #{easemobRegStatus},
					</if>
					<if test=" null != easemobNicknameStatus and ''!= easemobNicknameStatus  ">
						easemob_nickname_status = #{easemobNicknameStatus},
					</if>
					<if test=" null != createTime ">
						create_time = #{createTime},
					</if>
					<if test=" null != updateTime ">
						update_time = #{updateTime},
					</if>
					<if test=" null != isLocked ">
						is_locked = #{isLocked},
					</if>
					<if test=" null != enable ">
						enable = #{enable},
					</if>
					<if test=" null != delStatus ">
						del_status = #{delStatus},
					</if>
					<if test=" null != salesOrgId ">
						sales_org_id = #{salesOrgId},
					</if>
					<if test=" null != salesOrgDepth ">
						sales_org_depth = #{salesOrgDepth},
					</if>
			</trim>
		</set>
		<where>
			 id = #{id}
		</where>
	</update>
	
	<update id="updateInvitNumber" parameterType="com.linkwee.web.model.CrmCfplanner" >
	     update tcrm_cfplanner set invit_num=invit_num+1 where user_id = #{userId}
	</update>
  
	<update id="updateByPrimaryKey" parameterType="com.linkwee.web.model.CrmCfplanner" >
	    UPDATE tcrm_cfplanner
	   <set>
			<trim suffixOverrides=",">
					<if test=" null != userId and ''!= userId  ">
						user_id = #{userId},
					</if>
					<if test=" null != mobile and ''!= mobile  ">
						mobile = #{mobile},
					</if>
					<if test=" null != email and ''!= email  ">
						email = #{email},
					</if>
					<if test=" null != parentId and ''!= parentId  ">
						parent_id = #{parentId},
					</if>
					<if test=" null != qrcode and ''!= qrcode  ">
						qrcode = #{qrcode},
					</if>
					<if test=" null != empNo and ''!= empNo  ">
						emp_no = #{empNo},
					</if>
					<if test=" null != department and ''!= department  ">
						department = #{department},
					</if>
					<if test=" null != settlementType ">
						settlement_type = #{settlementType},
					</if>
					<if test=" null != cfpLevel and ''!= cfpLevel  ">
						cfp_level = #{cfpLevel},
					</if>
					<if test=" null != cfpRegTime ">
						cfp_reg_time = #{cfpRegTime},
					</if>
					<if test=" null != cfpBenormalTime ">
						cfp_benormal_time = #{cfpBenormalTime},
					</if>
					<if test=" null != cfpUpdateTime ">
						cfp_update_time = #{cfpUpdateTime},
					</if>
					<if test=" null != levelExperience ">
						level_experience = #{levelExperience},
					</if>
					<if test=" null != headImage and ''!= headImage  ">
						head_image = #{headImage},
					</if>
					<if test=" null != remark and ''!= remark  ">
						remark = #{remark},
					</if>
					<if test=" null != disabledLoginTime ">
						disabled_login_time = #{disabledLoginTime},
					</if>
					<if test=" null != easemobAcct and ''!= easemobAcct  ">
						easemob_acct = #{easemobAcct},
					</if>
					<if test=" null != easemobPassword and ''!= easemobPassword  ">
						easemob_password = #{easemobPassword},
					</if>
					<if test=" null != easemobRegStatus and ''!= easemobRegStatus  ">
						easemob_reg_status = #{easemobRegStatus},
					</if>
					<if test=" null != easemobNicknameStatus and ''!= easemobNicknameStatus  ">
						easemob_nickname_status = #{easemobNicknameStatus},
					</if>
					<if test=" null != createTime ">
						create_time = #{createTime},
					</if>
					<if test=" null != updateTime ">
						update_time = #{updateTime},
					</if>
					<if test=" null != isLocked ">
						is_locked = #{isLocked},
					</if>
					<if test=" null != enable ">
						enable = #{enable},
					</if>
					<if test=" null != delStatus ">
						del_status = #{delStatus},
					</if>
					<if test=" null != salesOrgId ">
						sales_org_id = #{salesOrgId},
					</if>
					<if test=" null != salesOrgDepth ">
						sales_org_depth = #{salesOrgDepth},
					</if>
			</trim>
		</set>
		<where>
			id = #{0}
		</where>
	  </update>
	  
	  <update id="updateByUserId" parameterType="com.linkwee.web.model.CrmCfplanner" >
  		UPDATE tcrm_cfplanner
		<set>
			<trim suffixOverrides=",">
					<if test=" null != mobile and ''!= mobile  ">
						mobile = #{mobile},
					</if>
					<if test=" null != email and ''!= email  ">
						email = #{email},
					</if>
					<if test=" null != parentId ">
						parent_id = #{parentId},
					</if>
					<if test=" null != qrcode and ''!= qrcode  ">
						qrcode = #{qrcode},
					</if>
					<if test=" null != empNo and ''!= empNo  ">
						emp_no = #{empNo},
					</if>
					<if test=" null != department and ''!= department  ">
						department = #{department},
					</if>
					<if test=" null != settlementType ">
						settlement_type = #{settlementType},
					</if>
					<if test=" null != cfpLevel and ''!= cfpLevel  ">
						cfp_level = #{cfpLevel},
					</if>
					<if test=" null != cfpRegTime ">
						cfp_reg_time = #{cfpRegTime},
					</if>
					<if test=" null != cfpBenormalTime ">
						cfp_benormal_time = #{cfpBenormalTime},
					</if>
					<if test=" null != cfpUpdateTime ">
						cfp_update_time = #{cfpUpdateTime},
					</if>
					<if test=" null != levelExperience ">
						level_experience = #{levelExperience},
					</if>
					<if test=" null != headImage and ''!= headImage  ">
						head_image = #{headImage},
					</if>
					<if test=" null != remark and ''!= remark  ">
						remark = #{remark},
					</if>
					<if test=" null != rectVisitTime ">
						rect_visit_time = #{rectVisitTime},
					</if>
					<if test=" null != disabledLoginTime ">
						disabled_login_time = #{disabledLoginTime},
					</if>
					<if test=" null != easemobAcct and ''!= easemobAcct  ">
						easemob_acct = #{easemobAcct},
					</if>
					<if test=" null != easemobPassword and ''!= easemobPassword  ">
						easemob_password = #{easemobPassword},
					</if>
					<if test=" null != easemobRegStatus and ''!= easemobRegStatus  ">
						easemob_reg_status = #{easemobRegStatus},
					</if>
					<if test=" null != easemobNicknameStatus and ''!= easemobNicknameStatus  ">
						easemob_nickname_status = #{easemobNicknameStatus},
					</if>
					<if test=" null != createTime ">
						create_time = #{createTime},
					</if>
					<if test=" null != updateTime ">
						update_time = #{updateTime},
					</if>
					<if test=" null != isLocked ">
						is_locked = #{isLocked},
					</if>
					<if test=" null != enable ">
						enable = #{enable},
					</if>
					<if test=" null != delStatus ">
						del_status = #{delStatus},
					</if>
					<if test=" null != salesOrgId ">
						sales_org_id = #{salesOrgId},
					</if>
					<if test=" null != weiXinOpenId ">
						weixin_openid = #{weiXinOpenId},
					</if>
					<if test=" null != isImportant ">
						is_important = #{isImportant},
					</if>
					<if test=" null != salesOrgDepth ">
						sales_org_depth = #{salesOrgDepth},
					</if>
			</trim>
		</set>
		<where>
			 user_id = #{userId}
		</where>
	</update>

	<!-- 分页条件查询 -->
    <select id="selectBySearchInfo" resultMap="BaseResultMap" parameterType="com.linkwee.core.datatable.DataTable">
        SELECT
        <include refid="Base_Column_List" />
        FROM tcrm_cfplanner
        <where> 
        <if test="dt.search!=null">  
                name LIKE CONCAT('%','${dt.search.value}','%' )  
         </if>  
         <if test="dt.order!=null">  
               <foreach collection="dt.order" index="index" item="item"
                    open="order by" separator="," close=" ">
                    ${item.name} ${item.dir} 
                </foreach>
         </if>  
        </where>
    </select>
    
    <!-- 根据手机号码查投资用户的理财师 -->
    <select id="queryCfplannerByInvestMobile" resultMap="BaseResultMap2"  parameterType="String">
		SELECT c.*,u.user_name FROM tcrm_cfplanner c JOIN tcrm_user_info u ON c.user_id = u.user_id 
		LEFT JOIN tcrm_investor i ON i.cfplanner = c.user_id 
		WHERE 1 = 1 AND i.mobile =#{investorMobile}
  	</select>
  	
  	<!-- 根据userId查投资用户的理财师 -->
    <select id="queryCfplannerByInvestor" resultMap="BaseResultMap2"  parameterType="String">
		SELECT c.*,u.user_name FROM tcrm_cfplanner c JOIN tcrm_user_info u ON c.user_id = u.user_id 
		LEFT JOIN tcrm_investor i ON i.cfplanner = c.user_id 
		WHERE 1 = 1 AND i.user_id =#{investorUserId}
  	</select>
  	
  	<!--  根据环信帐号获取用户信息 -->
	<select id="queryCfplannerByEasemob" resultMap="BaseResultMap2"  >
 		select c.*, u.user_name from tcrm_cfplanner c join tcrm_user_info u on c.user_id=u.user_id
		<where>
			<foreach item="item" index="index" collection="list"  open="(" separator="or" close=") ">
				  c.easemob_acct  = #{item}
			</foreach>
		</where>
	</select>

	<select id="selectRegCfplanners" resultType="java.lang.String">
		SELECT mobile from tcrm_cfplanner
		<where>
			<foreach item="item" index="index" collection="array" open=" mobile in ("
				separator="," close=") ">
				#{item}
			</foreach>
		</where>
	</select>
	
	<select id="selectByUserId" resultMap="BaseResultMap2"
		parameterType="java.lang.String">
		select t.*, u.user_name from tcrm_cfplanner t join tcrm_user_info u on t.user_id=u.user_id
		<include refid="Base_Column_List" />
		from tcrm_cfplanner t
		where t.user_id = #{userId,jdbcType=VARCHAR}
	</select>
	
	<update id="updateCfpQrByUserId" parameterType="com.linkwee.web.model.CrmCfplanner">
		update tcrm_cfplanner
		set qrcode = #{qrcode,jdbcType=VARCHAR}
		where user_id = #{userId,jdbcType=VARCHAR}
	</update>
	
	<!-- 查理财师的团队人数 -->
	<select id="queryTeamMemberCount" resultType="int" parameterType="java.lang.String">
		SELECT 
		(SELECT IFNULL(count(1),0) from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR})
		+
		(SELECT IFNULL(count(1),0) from tcrm_cfplanner where parent_id in (SELECT user_id from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR}))
	</select>
	
	<!-- 查理财师的所有团队成员 -->
	<select id="queryTeamAllMember" resultMap="BaseResultMap" parameterType="java.lang.String">
		SELECT * from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR}
		union
		SELECT * from tcrm_cfplanner where parent_id in (SELECT user_id from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR})
	</select>
	
	<!-- 查理财师的一级下级成员 -->
	<select id="queryLowerLevelOne" resultMap="BaseResultMap" parameterType="java.lang.String">
		SELECT * from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR}
	</select>
	
	<!-- 查理财师的一级下级成员-分页 -->
	<select id="queryLowerLevelOneList" resultType="com.linkwee.web.model.CrmCfplanner">
		SELECT c.head_image,u.user_name,c.mobile from tcrm_cfplanner c LEFT JOIN tcrm_user_info u on c.user_id = u.user_id 
		 where parent_id=#{userId,jdbcType=VARCHAR}
	</select>
	
	<!-- 更新理财师职级经验 -->
	<update id="updateCfplannerRankExperience" >
		update tcrm_cfplanner t SET t.cfp_level=#{level},t.level_experience=t.level_experience+#{experience} WHERE t.user_id=#{userId}
	</update>
		
	
	<!-- 符合分配规则的理财师 -->
	<select id="queryConformAllotRuleCfps" resultType="String" >
		SELECT cfplanner from (
		SELECT IFNULL(sum(r.invest_amt),0) totalInvestAmt ,i.cfplanner from tcim_product_invest_record r LEFT JOIN tcrm_investor i on r.user_id=i.user_id 
		where r.biz_time>= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
		GROUP BY i.cfplanner
		) t
		where totalInvestAmt>10000
		and cfplanner in
		(
		SELECT user_id from tcrm_cfplanner where rect_visit_time>= DATE_SUB(CURDATE(), INTERVAL 7 DAY)
		)
	</select>
	
	<!-- 7天内登录过的理财师 -->
	<select id="queryLoginInSevenDaysCfp" resultType="String" >
		SELECT user_id from tcrm_cfplanner where rect_visit_time>= DATE_SUB(CURDATE(), INTERVAL 7 DAY)
	</select>
	
	<!-- 理财师客户数量 -->
	<select id="queryCustomerCount" resultType="int" >
		SELECT count(1) from tcrm_investor where cfplanner=#{userId}
	</select>
	
	<!-- 查规定分配自由用户的理财师 -->
	<select id="querySpecifiedCfps" resultType="String" >
		SELECT c.user_id from tsys_special_user_list s LEFT JOIN tcrm_cfplanner c on s.mobile=c.mobile where s.type=1 and c.user_id is not null
	</select>
	
	<!-- 邀请理财师记录 -->
    <select id="queryInvitationCfplannerRecord"  resultType="com.linkwee.web.model.crm.InvotateUserListResp" parameterType="com.linkwee.api.request.crm.InvotationRequest">
    	SELECT
			i.user_id userId,
			i.mobile mobile,
			u.user_name userName,
			i.create_time registerDate,
			case when i.rect_invest_time is null then '1' else '0' END investFlag
		FROM
			tcrm_investor i JOIN tcrm_user_info u on i.user_id=u.user_id 
		JOIN tcrm_cfplanner c on i.user_id=c.user_id
		WHERE
			i.ref_user = #{userId,jdbcType=VARCHAR}
	 	order by i.id desc
    </select>
    
    <!-- 邀请理财师记录统计 -->
    <select id="queryInvitationCfplannerRecordStatistics"  resultType="int" >
    	SELECT
			count(1)
		FROM
			tcrm_investor i JOIN tcrm_user_info u on i.user_id=u.user_id 
		JOIN tcrm_cfplanner c on i.user_id=c.user_id
		WHERE
			i.ref_user = #{userId,jdbcType=VARCHAR}
    </select>
    
   <!--  查销售机构数 -->
    <select id="querySalesOrgCount"  resultType="int" >
    	SELECT
			count(1)
		FROM
			tcrm_sales_org
		WHERE
			sales_org_id = #{salesOrgId,jdbcType=VARCHAR}
    </select>
    
     <!--  是否新用户 -->
    <select id="isNew"  resultType="int" >
    	SELECT COUNT(*) FROM tcrm_investor i WHERE i.cfplanner=#{userId} AND first_invest_time IS NOT NULL
    </select>
    
    <!-- V4.0个人中心 -->
	<select id="personalCenter" resultType="com.linkwee.web.model.CrmCfplanner">
		SELECT c.head_image,u.user_name,c.mobile,a.bank_card bankCard from tcrm_cfplanner c 
		LEFT JOIN tac_account_bind a on c.user_id = a.user_id 
		LEFT JOIN tcrm_user_info u on c.user_id = u.user_id 
		 where c.user_id=#{userId,jdbcType=VARCHAR}
	</select>
	
	
	<!-- V4.0个人名片 个人信息 -->
	<select id="queryCfpUserInfo" resultType="com.linkwee.web.model.CrmCfplanner">
		SELECT u.user_name,c.mobile,c.qrcode from tcrm_cfplanner c LEFT JOIN tcrm_user_info u on c.user_id = u.user_id  
		 where c.user_id=#{userId,jdbcType=VARCHAR}
	</select>
	
	<!-- V4.0邀请记录 推荐理财师 -->
	<select id="invitationCfpList" resultType="com.linkwee.web.model.CrmCfplanner" >
<!-- 		SELECT date_format(c.cfp_reg_time, '%Y-%m-%d') cfpRegTime  ,u.user_name,c.mobile,c.qrcode ,c.user_id, -->
<!-- 		(select count(*) from tcrm_cfplanner cf where cf.parent_id = c.user_id) haveInvitation  -->
<!-- 		 from tcrm_cfplanner c LEFT JOIN tcrm_user_info u on c.user_id = u.user_id   -->
<!-- 				 where c.parent_id=#{userId,jdbcType=VARCHAR} order by c.cfp_reg_time desc -->
		SELECT
     		c.qrcode ,
     		date_format(c.cfp_reg_time, '%Y-%m-%d') cfpRegTime  ,
			 (select count(*) from tcrm_cfplanner cf where cf.parent_id = c.user_id) haveInvitation ,
			i.user_id userId,
			i.mobile mobile,
			u.user_name userName,
			i.create_time registerDate
		FROM
			tcrm_investor i JOIN tcrm_user_info u on i.user_id=u.user_id 
		JOIN tcrm_cfplanner c on i.user_id=c.user_id
		WHERE
			i.ref_user = #{userId,jdbcType=VARCHAR}
	 	order by i.id desc
	 </select>
	 
	 <!-- V4.0邀请记录 邀请客户 -->
	<select id="invitationInvestorList" resultType="com.linkwee.web.model.CrmCfplanner" >
		SELECT
			i.user_id userId,
			i.mobile mobile,
			u.user_name userName,
date_format(i.create_time, '%Y-%m-%d') cfpRegTime,
			case when i.rect_invest_time is null then '0' else '1' END isInvest
		FROM
			tcrm_investor i JOIN tcrm_user_info u on i.user_id=u.user_id 
		LEFT JOIN tcrm_cfplanner c on i.user_id=c.user_id
		WHERE
			i.ref_user = #{userId,jdbcType=VARCHAR}  
		 and c.id is null
	 	order by i.id desc

	 </select>
	 
	 <!-- 从fromTime开始注册的理财师人数 -->
    <select id="queryNewCfpNumber"  resultType="int" >
    	SELECT
			count(DISTINCT user_id)
		FROM
			tcrm_cfplanner
		WHERE
			DATE_FORMAT(create_time, '%Y-%m-%d') >= DATE_FORMAT(#{fromTime}, '%Y-%m-%d')
    </select>
    
    <select id="queryCfplannerInfo" resultType="com.linkwee.web.model.CrmCfplanner">
		SELECT u.user_name,c.* from tcrm_cfplanner c LEFT JOIN tcrm_user_info u on c.user_id = u.user_id  
		 where c.user_id=#{userId,jdbcType=VARCHAR}
	</select>
	
	<!-- 查理财师的客户人数 -->
	<select id="queryCustomerMember" resultType="int" parameterType="java.lang.String">
		SELECT IFNULL(count(1),0) from tcrm_investor where cfplanner=#{userId,jdbcType=VARCHAR}
	</select>
	
	<select id="queryInvestorList" resultType="com.linkwee.web.model.CrmInvestor" parameterType="java.lang.String">
		SELECT * from tcrm_investor where cfplanner=#{userId,jdbcType=VARCHAR}
	</select>
	
	<!-- 4.5.0我的-理财师团队成员统计信息 -->
	<select id="queryCfplannerMemberNum" resultType="com.linkwee.web.model.crm.CfplannerInvestorPersonResp" parameterType="java.lang.String">
		select 
		(select count(*) from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR}) as directRecomNum,
		(select count(*) from tcrm_cfplanner where parent_id in(select user_id from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR})) as secondLevelNum,
		(select count(*) from tcrm_cfplanner where parent_id in(select user_id from tcrm_cfplanner where parent_id in(select user_id from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR}))) as threeLevelNum,
		(SELECT count(*) FROM tcrm_cfplanner where parent_id =#{userId,jdbcType=VARCHAR} and is_important = '1') as myAttention,
		(SELECT count(*) FROM tcrm_cfplanner cf LEFT JOIN tcrm_investor ti on cf.user_id=ti.user_id where parent_id =#{userId,jdbcType=VARCHAR} and (ti.rect_invest_time is null and ti.first_invest_time is null)) as noInvest;
	</select>
	
	<!-- 4.5.0我的-理财师团队成员分页 -->
	<select id="queryCfpmemberPage" parameterType="com.linkwee.api.request.crm.UserTypeRequest" resultType="com.linkwee.api.response.crm.CustomerCfpmember" >
	    select tcf.user_id,tui.user_name,tcf.head_image,tui.mobile,date_format(tin.rect_invest_time,'%Y-%m-%d') as recentTranDate,tcf.job_grade as grade,date_format(tcf.cfp_reg_time,'%Y-%m-%d') as registTime from tcrm_cfplanner tcf LEFT JOIN tcrm_investor tin on tcf.user_id= tin.user_id 
		LEFT JOIN tcrm_user_info tui on tui.user_id=tcf.user_id where parent_id=#{userId,jdbcType=VARCHAR}  
		<if test=" null != nameOrMobile and ''!= nameOrMobile ">
	 		and tui.user_name  LIKE CONCAT('%','${nameOrMobile}','%')  or tui.mobile LIKE CONCAT('%','${nameOrMobile}','%')
		</if>	
		<if test=" attenInvestType == 3 ">
			 and (tin.rect_invest_time is null and tin.first_invest_time is null) order by tcf.cfp_reg_time desc
 		</if>
	</select>
	
	<select id="queryCfpmemberPageOther" parameterType="com.linkwee.api.request.crm.UserTypeRequest" resultType="com.linkwee.api.response.crm.CustomerCfpmember" >
		 select nb.* from (
	 		select  a.is_important,a.user_id,a.user_name,a.head_image,a.mobile,a.recentTranDate,a.grade,a.registTime from 
				(select tcf.is_important,tcf.user_id,tui.user_name,tcf.head_image,tui.mobile,date_format(tin.rect_invest_time,'%Y-%m-%d') as recentTranDate,tcf.job_grade as grade,date_format(tcf.cfp_reg_time,'%Y-%m-%d') as registTime from tcrm_cfplanner tcf LEFT JOIN tcrm_investor tin on tcf.user_id= tin.user_id 
				LEFT JOIN tcrm_user_info tui on tui.user_id=tcf.user_id where parent_id=#{userId,jdbcType=VARCHAR}  
				and tin.rect_invest_time is not null 
				) a
			union   
			select   b.is_important,b.user_id,b.user_name,b.head_image,b.mobile,b.recentTranDate,b.grade,b.registTime from
				(select tcf.is_important,tcf.user_id,tui.user_name,tcf.head_image,tui.mobile,date_format(tin.rect_invest_time,'%Y-%m-%d') as recentTranDate,tcf.job_grade as grade,date_format(tcf.cfp_reg_time,'%Y-%m-%d') as registTime from tcrm_cfplanner tcf LEFT JOIN tcrm_investor tin on tcf.user_id= tin.user_id 
				LEFT JOIN tcrm_user_info tui on tui.user_id=tcf.user_id where parent_id=#{userId,jdbcType=VARCHAR} 
				and tin.rect_invest_time is  null 
				) b
		) nb where 1=1 
		<if test=" null != nameOrMobile and ''!= nameOrMobile ">
	 		and nb.user_name  LIKE CONCAT('%','${nameOrMobile}','%') or nb.mobile LIKE CONCAT('%','${nameOrMobile}','%')
		</if>
		<if test=" attenInvestType == 4 ">
			 and nb.is_important='1'
 		</if>
		order by nb.recentTranDate desc,nb.registTime desc
	</select>
	
	<!-- 4.5.0我的-直接理财师成员 -->
	<select id="cfplannerMemberPage" resultType="com.linkwee.api.response.crm.CfplannerMemberResponse" >
	    select tcf.user_id as userId,tui.user_name as userName,tcf.head_image as headImage,tui.mobile,
		DATE_FORMAT(tcf.cfp_reg_time, '%Y-%m-%d') as registTime from tcrm_cfplanner tcf LEFT JOIN tcrm_investor tin on tcf.user_id= tin.user_id 
		LEFT JOIN tcrm_user_info tui on tui.user_id=tcf.user_id where parent_id=#{userId,jdbcType=VARCHAR} 
	</select>
	
	<!--4.5.0我的-理财师详情-投资记录 -->
	<select id="cfpInvestRecordPage" resultType="com.linkwee.api.response.crm.CustomerMemberInvestRecordResponse" >	
        <![CDATA[ 
        select tpir.start_time,'1' as userType,DATE_FORMAT(tpir.start_time, '%Y-%m-%d') as investTime,toi.name as orgName,tf.bill_id as investId,tf.product_amount as investAmt
		from tcim_fee tf LEFT JOIN tcim_org_info toi on toi.org_number = tf.product_org_id left JOIN tcim_product_invest_record tpir on tf.bill_id = tpir.invest_id left join tcrm_investor tcrm on tf.investor_id = tcrm.user_id 
		where profit_cfplanner_id=#{userId,jdbcType=VARCHAR}  and  tcrm.cfplanner=#{cfpUserId,jdbcType=VARCHAR} and tf.fee_amount<>0
		GROUP BY  tf.bill_id 
		union all
		
		select tpir.start_time,'2' as userType,DATE_FORMAT(tpir.start_time, '%Y-%m-%d') as investTime,toi.name as orgName,tf.bill_id as investId,tf.product_amount as investAmt
		from tcim_fee tf LEFT JOIN tcim_org_info toi on toi.org_number = tf.product_org_id left JOIN tcim_product_invest_record tpir on tf.bill_id = tpir.invest_id left join tcrm_investor tcrm on tf.investor_id = tcrm.user_id 
		where profit_cfplanner_id=#{userId,jdbcType=VARCHAR} and tf.fee_amount<>0 and 
		tcrm.cfplanner in(select user_id  from tcrm_cfplanner where parent_id =#{cfpUserId,jdbcType=VARCHAR}) GROUP BY  tf.bill_id 
		union all
		
		select tpir.start_time,'3' as userType,DATE_FORMAT(tpir.start_time, '%Y-%m-%d') as investTime,toi.name as orgName,tf.bill_id as investId,tf.product_amount as investAmt
		from tcim_fee tf LEFT JOIN tcim_org_info toi on toi.org_number = tf.product_org_id left JOIN tcim_product_invest_record tpir on tf.bill_id = tpir.invest_id left join tcrm_investor tcrm on tf.investor_id = tcrm.user_id 
		where profit_cfplanner_id=#{userId,jdbcType=VARCHAR} and tf.fee_amount<>0 and 
		tcrm.cfplanner in(select user_id  from tcrm_cfplanner where parent_id in(select user_id  from tcrm_cfplanner where parent_id =#{cfpUserId,jdbcType=VARCHAR})) GROUP BY  tf.bill_id 
		
		ORDER BY start_time desc 
		]]> 
	</select>
	
		<!-- 4.5.0我的-理财师详情-投资记录 -统计佣金 -->
	<select id="queryFeeAmountTotal" resultType="BigDecimal" >
		SELECT IFNULL(sum(fee_amount),0) from tcim_fee where bill_id=#{investId,jdbcType=VARCHAR} 
		and profit_cfplanner_id=#{userId,jdbcType=VARCHAR}
	</select>
	
	  <!--4.5.0我的-理财师成员详情统计信息 -->
	<select id="queryCfplannerDetail" resultType="com.linkwee.api.response.crm.CfplannerMemberDetailResponse" >
	    <![CDATA[
	    select 
		( select sum(thisMonthIssueAmt) from (select IFNULL(sum(invest_amt),0) as thisMonthIssueAmt from tcim_product_invest_record where user_id=#{userId,jdbcType=VARCHAR}  and DATE_FORMAT(start_time, '%Y-%m')=#{thisMonth,jdbcType=VARCHAR}   union all 
		select IFNULL(sum(invest_amt),0) as thisMonthIssueAmt from tcim_product_invest_record where user_id in(select user_id from  tcrm_investor where cfplanner=#{userId,jdbcType=VARCHAR} and user_id<>#{userId,jdbcType=VARCHAR}) 
		and DATE_FORMAT(start_time, '%Y-%m')=#{thisMonth,jdbcType=VARCHAR} 
		  ) t1
		) as thisMonthIssueAmt,
		
		( select sum(totalIssueAmt) from (select IFNULL(sum(invest_amt),0) as totalIssueAmt from tcim_product_invest_record where user_id=#{userId,jdbcType=VARCHAR}  union all
		select IFNULL(sum(invest_amt),0) as totalIssueAmt from tcim_product_invest_record where user_id in(select user_id from  tcrm_investor where cfplanner=#{userId,jdbcType=VARCHAR} and user_id<>#{userId,jdbcType=VARCHAR}) 
		   ) t2
		) as totalIssueAmt,
		
		(select DATE_FORMAT(login_lasttime, '%Y-%m-%d') from  tsm_customer_device where  user_id=#{userId,jdbcType=VARCHAR} limit 1)  as loginTime,
		
		(select  IFNULL(sum(tf.fee_amount),0) from tcim_product_invest_record tpir LEFT JOIN tcim_fee tf on tpir.invest_id = tf.bill_id where tpir.user_id=#{userId,jdbcType=VARCHAR} AND
		 tf.profit_cfplanner_id = #{profitUserId,jdbcType=VARCHAR}
		 and DATE_FORMAT(tpir.start_time, '%Y-%m')=#{thisMonth,jdbcType=VARCHAR}) as thisMonthProfit, 
		
		(select  IFNULL(sum(tf.fee_amount),0) from tcim_product_invest_record tpir LEFT JOIN tcim_fee tf on tpir.invest_id = tf.bill_id where tpir.user_id=#{userId,jdbcType=VARCHAR} AND
		 tf.profit_cfplanner_id = #{profitUserId,jdbcType=VARCHAR}) as totalProfit,
		 (select count(*) from tcrm_cfplanner where parent_id in(select user_id from tcrm_cfplanner where parent_id=#{userId,jdbcType=VARCHAR})) as secondLevelCfp;
		 ]]> 
	</select>

	<select id="query2017NewCfpNumber"  resultType="int" >
    	SELECT
			count(DISTINCT user_id)
		FROM
			tcrm_cfplanner
		WHERE
			DATE_FORMAT(create_time, '%Y-%m-%d') >= DATE_FORMAT(#{fromTime}, '%Y-%m-%d')
			AND DATE_FORMAT(create_time, '%Y-%m-%d') <![CDATA[<=]]> DATE_FORMAT(#{endTime}, '%Y-%m-%d')
    </select>
       
    <select id="queryForgeRewardData"  resultType="com.linkwee.api.activity.response.NewYearRewardResponse" >
    	SELECT
			user_id,
			mobile
		FROM
			tcrm_cfplanner
		ORDER BY user_id ASC
		LIMIT 100
    </select>
    
    <select id="lcsNumber"  resultType="java.lang.Integer" >
    	SELECT
			count(DISTINCT user_id) AS totalCfp
		FROM
			tcrm_cfplanner
    </select>   
      
    <select id="queryNewRegTop"  resultType="java.lang.String" >
    	SELECT
			mobile
		FROM
			tcrm_cfplanner
		ORDER BY
			id DESC
		LIMIT 10
    </select>
    
	<select id="queryCfplannerMonthInvestAmt" parameterType="com.linkwee.api.request.crm.CfplannerDataRequest" resultType="java.math.BigDecimal" >
		SELECT
			SUM(tpir.invest_amt)
		FROM
			tcim_product_invest_record tpir,
			tcrm_investor ti
		WHERE
			ti.cfplanner = #{userId}
		AND ti.user_id = tpir.user_id
		AND DATE_FORMAT(tpir.start_time, '%Y-%m') = DATE_FORMAT(
			#{queryDate},
			'%Y-%m'
		)
	</select>
	
	<select id="queryCfplannerMonthIncome" parameterType="com.linkwee.api.request.crm.CfplannerDataRequest" resultType="java.math.BigDecimal" >
		SELECT
			SUM(tf.fee_amount)
		FROM
			tcim_feedetail tf
		WHERE
			tf.profit_cfplanner_id = #{userId}
		AND DATE_FORMAT(tf.create_time, '%Y-%m') = DATE_FORMAT(
			#{queryDate},
			'%Y-%m'
		)	
	</select>
	
</mapper>